# 🎛️ 视图配置功能说明

## 新增功能

现在您可以实时调整视图设置，无需修改代码！

### 1. PPM（像素/米）缩放控制

**位置**: 属性面板顶部 "🔧 视图设置" 区域

**功能**: 调整视图缩放比例
- **范围**: 5 - 50
- **默认**: 20 (1米 = 20像素)
- **效果**: 
  - 👈 向左拖动 (5-15): 缩小视图，看到更大范围
  - 👉 向右拖动 (25-50): 放大视图，看到更多细节

**使用场景**:
```
PPM = 5   → 1米 = 5像素  → 看100m范围（小物体不清晰）
PPM = 10  → 1米 = 10像素 → 看50m范围（适合大型场景）
PPM = 20  → 1米 = 20像素 → 看25m范围（默认，平衡）
PPM = 40  → 1米 = 40像素 → 看12m范围（适合精细编辑）
PPM = 50  → 1米 = 50像素 → 看10m范围（最大细节）
```

### 2. 原点 X 偏移

**位置**: 视图设置区域第二个滑块

**功能**: 左右移动视图原点
- **范围**: -20m 到 +20m
- **默认**: 0m (Canvas 中心)
- **效果**:
  - 向右拖动: 物体整体向左移动（原点向右）
  - 向左拖动: 物体整体向右移动（原点向左）

**使用场景**:
- 查看画布左侧或右侧区域
- 调整场景在画布中的位置
- 聚焦特定区域

### 3. 原点 Y 偏移

**位置**: 视图设置区域第三个滑块

**功能**: 上下移动视图原点
- **范围**: -20m 到 +20m
- **默认**: 0m (Canvas 底部)
- **效果**:
  - 向右拖动: 物体整体向下移动（原点向上）
  - 向左拖动: 物体整体向上移动（原点向下）

**使用场景**:
- 查看地面以下或空中区域
- 调整垂直视角
- 设计多层场景

### 4. 重置视图按钮

**位置**: 视图设置区域底部

**功能**: 一键恢复默认设置
- PPM → 20
- 原点 X → 0m
- 原点 Y → 0m

## 📊 实时效果

所有调整都会**实时生效**：
- ✅ 网格自动重绘
- ✅ 所有物体重新定位
- ✅ 坐标标签更新
- ✅ 选中和交互保持正常

## 🎮 使用示例

### 示例 1: 设计大型场景
```
场景: 100m × 50m 的竞技场

设置:
- PPM: 8 (缩小)
- 原点 X: 0m
- 原点 Y: -25m (看到更高的区域)

效果: 可以在画布中看到整个竞技场
```

### 示例 2: 精细编辑小物体
```
场景: 1m × 1m 的小机关

设置:
- PPM: 40 (放大)
- 原点 X: 调整到物体位置
- 原点 Y: 调整到物体位置

效果: 物体占据大部分画布，便于精细调整
```

### 示例 3: 地下场景
```
场景: 地下 -10m 的洞穴

设置:
- PPM: 20 (默认)
- 原点 X: 0m
- 原点 Y: -15m (原点下移)

效果: 可以看到地面以下的区域
```

### 示例 4: 高空场景
```
场景: 50m 高的塔楼

设置:
- PPM: 15 (稍微缩小)
- 原点 X: 0m
- 原点 Y: 25m (原点上移)

效果: 可以看到高处的平台
```

## 💡 使用技巧

### 1. 先缩放后平移
- 先调整 PPM 找到合适的缩放级别
- 再调整原点偏移聚焦到目标区域

### 2. 使用重置按钮
- 迷失方向时，点击"重置视图"快速回到默认状态
- 设计完成后重置，方便导出标准视图

### 3. 配合状态栏
- 观察状态栏的坐标显示
- 确认鼠标指向的实际 Box2D 坐标
- 坐标始终显示真实的 Box2D 米单位

### 4. 保存前重置（可选）
- 视图设置不影响保存的数据
- 所有对象坐标都是绝对的 Box2D 坐标
- 加载文件后可以自由调整视图

## ⚙️ 技术细节

### 坐标转换逻辑
```typescript
// 应用了原点偏移的转换公式

Box2D → Canvas:
canvasX = width/2 + (box2dX - ORIGIN_OFFSET_X) * PPM
canvasY = height - (box2dY - ORIGIN_OFFSET_Y) * PPM

Canvas → Box2D:
box2dX = (canvasX - width/2) / PPM + ORIGIN_OFFSET_X
box2dY = (height - canvasY) / PPM + ORIGIN_OFFSET_Y
```

### 变量定义
```typescript
let PPM = 20;                // 可实时调整
let ORIGIN_OFFSET_X = 0;     // 可实时调整
let ORIGIN_OFFSET_Y = 0;     // 可实时调整
```

### 不影响数据
- ✅ 对象的 Box2D 坐标不变
- ✅ 保存的 JSON 文件不包含视图设置
- ✅ 导出的 Box2D 数据不受影响
- ✅ 只影响显示，不影响数据

## 🎨 视觉指示

### 原点标记
- 红色十字始终标记 (0, 0) 点
- 随着原点偏移移动
- 帮助判断当前视图位置

### 网格标签
- 自动根据 PPM 调整密度
- 始终显示 Box2D 米坐标
- 不受原点偏移影响（显示绝对坐标）

### 坐标显示
- 状态栏显示鼠标的绝对 Box2D 坐标
- 属性面板显示对象的绝对坐标
- 所有坐标都是真实的物理坐标

## 🚀 快捷工作流

### 宏观 → 微观
1. 开始: PPM = 10, 查看全局
2. 布局大型物体和结构
3. 增加: PPM = 30, 精细调整细节
4. 完成: PPM = 20, 导出标准视图

### 多区域编辑
1. 设置: PPM = 15 (中等)
2. 调整原点偏移到区域1
3. 编辑区域1
4. 调整原点偏移到区域2
5. 编辑区域2
6. 完成后重置视图

### 垂直场景
1. 上层: ORIGIN_Y = +10m
2. 编辑上层平台和物体
3. 地面: ORIGIN_Y = 0m
4. 编辑地面
5. 地下: ORIGIN_Y = -10m
6. 编辑地下洞穴

## ❓ 常见问题

**Q: 调整视图后保存的文件会变吗？**
A: 不会。所有对象使用绝对 Box2D 坐标存储，视图设置不保存。

**Q: 原点偏移后，创建的物体坐标会变吗？**
A: 不会。鼠标点击位置会自动转换为正确的 Box2D 坐标。

**Q: 可以设置负数坐标吗？**
A: 可以。Box2D 支持负坐标，原点偏移可以让您方便地编辑任意区域。

**Q: 视图设置的范围够用吗？**
A: 如需更大范围，可以在代码中修改滑块的 min/max 值。

**Q: 会影响性能吗？**
A: 不会。只是改变渲染方式，不增加计算量。

## 🎉 总结

现在您拥有完全灵活的视图控制：
- 🔍 自由缩放（5-50倍）
- ↔️ 左右平移（±20m）
- ↕️ 上下平移（±20m）
- 🔄 一键重置
- 💾 不影响数据
- ⚡ 实时生效

享受更高效的地图设计体验！ 🚀

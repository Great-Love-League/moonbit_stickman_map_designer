# 物理预览测试场景

## 测试目的
验证 v2.1.0 物理预览功能是否正常工作。

## 测试场景 1：自由落体

### 场景描述
一个动态圆球从空中自由下落，撞击地面静态平台。

### 创建步骤
1. **创建地面**：
   - 工具：矩形工具
   - 位置：(0, -5)
   - 尺寸：宽 10m × 高 1m
   - 类型：Static（静态）
   - 属性：默认

2. **创建圆球**：
   - 工具：圆形工具
   - 位置：(0, 5)
   - 半径：0.5m
   - 类型：Dynamic（动态）
   - 密度：1.0
   - 弹性：0.5

### 预期效果
- ✅ 圆球受重力下落
- ✅ 撞击地面后反弹
- ✅ 多次反弹后停止在地面上
- ✅ 地面保持固定不动

### 测试步骤
1. 创建上述两个物体
2. 点击 "▶ 预览" 按钮
3. 观察圆球下落和反弹
4. 测试暂停/继续功能
5. 测试重置功能
6. 按 ESC 退出预览

---

## 测试场景 2：倾斜滑坡

### 场景描述
一个动态方块从倾斜的静态斜坡滑下。

### 创建步骤
1. **创建斜坡**：
   - 工具：矩形工具
   - 位置：(3, -3)
   - 尺寸：宽 8m × 高 1m
   - 旋转角度：30°
   - 类型：Static（静态）
   - 摩擦：0.3

2. **创建方块**：
   - 工具：矩形工具
   - 位置：(6, 2)
   - 尺寸：宽 1m × 高 1m
   - 类型：Dynamic（动态）
   - 密度：1.0
   - 摩擦：0.5

### 预期效果
- ✅ 方块下落到斜坡上
- ✅ 方块沿斜坡滑动
- ✅ 摩擦力影响滑动速度
- ✅ 方块最终滚落或停止

### 测试步骤
1. 创建上述两个物体
2. 调整斜坡角度
3. 启动物理预览
4. 观察滑动效果
5. 尝试修改摩擦力后重新预览

---

## 测试场景 3：多物体碰撞

### 场景描述
多个动态物体从不同高度落下，相互碰撞。

### 创建步骤
1. **创建地面**：
   - 矩形：(0, -5)，宽 15m × 高 1m
   - 类型：Static

2. **创建物体堆**：
   - 圆形 1：(-2, 8)，半径 0.5m，动态
   - 圆形 2：(0, 6)，半径 0.6m，动态
   - 方块 1：(2, 7)，1m × 1m，动态
   - 方块 2：(-1, 4)，0.8m × 0.8m，动态

3. **调整属性**：
   - 密度：1.0
   - 弹性：0.3-0.7（不同物体不同）
   - 摩擦：0.5

### 预期效果
- ✅ 所有物体受重力下落
- ✅ 物体之间发生碰撞
- ✅ 不同弹性导致不同反弹效果
- ✅ 物体最终堆叠在地面上

---

## 测试场景 4：摆锤（关节测试）

### 场景描述
一个用旋转关节连接的摆锤系统。

### 创建步骤
1. **创建支撑点**：
   - 圆形：(0, 5)，半径 0.3m
   - 类型：Static（固定在空中）

2. **创建摆锤**：
   - 矩形：(0, 0)，宽 0.5m × 高 3m
   - 类型：Dynamic
   - 密度：2.0

3. **创建关节**：
   - 工具：关节工具
   - 连接：支撑点 → 摆锤
   - 锚点A：(0, 0)（支撑点中心）
   - 锚点B：(0, 1.5)（摆锤顶部）
   - 角度限制：开启
   - 范围：-90° 到 90°

4. **给初始偏移**：
   - 将摆锤旋转约 30°

### 预期效果
- ✅ 摆锤以支撑点为中心摆动
- ✅ 角度限制在 ±90° 范围内
- ✅ 摆动幅度逐渐减小（阻尼）
- ✅ 最终停在竖直位置

### 测试步骤
1. 创建支撑点和摆锤
2. 添加旋转关节连接
3. 旋转摆锤给予初始角度
4. 启动预览观察摆动
5. 测试角度限制效果

---

## 测试场景 5：复杂多边形

### 场景描述
测试自定义多边形的物理模拟。

### 创建步骤
1. **创建地面**：
   - 矩形：(0, -5)，宽 15m × 高 1m
   - 类型：Static

2. **创建三角形**：
   - 工具：多边形工具
   - 顶点 1：(0, 0)
   - 顶点 2：(1, 0)
   - 顶点 3：(0.5, 1.5)
   - 位置：(-3, 5)
   - 类型：Dynamic

3. **创建五边形**：
   - 工具：多边形工具
   - 创建正五边形（近似）
   - 位置：(3, 6)
   - 类型：Dynamic

### 预期效果
- ✅ 多边形按正确形状显示
- ✅ 多边形受重力下落
- ✅ 多边形碰撞检测正确
- ✅ 多边形旋转自然

### ⚠️ 注意
- Box2D 要求多边形顶点按**逆时针**顺序
- 如果多边形表现异常，检查顶点顺序

---

## 功能测试清单

### 基本功能
- [ ] 点击 "▶ 预览" 按钮启动预览
- [ ] 按 Space 键启动预览
- [ ] 预览控制面板正确显示
- [ ] 属性面板自动隐藏
- [ ] 状态栏显示预览模式

### 预览控制
- [ ] ⏸ 暂停按钮工作
- [ ] ▶ 播放按钮工作（暂停后）
- [ ] Space 键切换暂停/播放
- [ ] 🔄 重置按钮重建场景
- [ ] ❌ 退出按钮返回编辑模式
- [ ] ESC 键退出预览

### 物理效果
- [ ] 动态物体受重力影响
- [ ] 静态物体保持固定
- [ ] 物体之间正确碰撞
- [ ] 弹性系数影响反弹
- [ ] 摩擦力影响滑动
- [ ] 密度影响物体质量
- [ ] 阻尼影响速度衰减

### 关节功能
- [ ] 旋转关节正确连接物体
- [ ] 关节锚点位置正确
- [ ] 角度限制正常工作
- [ ] 关节不会分离

### 性能测试
- [ ] 60 FPS 流畅运行
- [ ] 暂停时物理计算停止
- [ ] 多物体场景不卡顿
- [ ] 内存使用正常

### 边界情况
- [ ] 空场景提示无物体
- [ ] Box2D 未加载提示错误
- [ ] 只有关节无物体的情况
- [ ] 退出预览后可继续编辑

---

## 错误测试

### 测试 1：Box2D 未加载
1. 删除或重命名 `/box2d-js/lib/box2d.js`
2. 点击预览按钮
3. **预期**：弹出 "Box2D 物理引擎未加载！" 提示

### 测试 2：空场景预览
1. 清空所有物体
2. 点击预览按钮
3. **预期**：弹出 "场景中没有物体！" 提示

### 测试 3：只有关节无物体
1. 删除所有物体，只保留关节（如果可能）
2. 点击预览按钮
3. **预期**：关节被跳过，正常进入预览

---

## 性能基准

### 推荐配置
- **物体数量**: < 50 个
- **多边形顶点**: < 8 个
- **关节数量**: < 30 个

### 极限测试
- **100 个物体**: 测试性能
- **复杂多边形**: 10+ 顶点
- **大量关节**: 50+ 个关节

---

## 控制台检查

### 正常启动输出
```
开始物理预览...
Box2D 世界已创建: X 个物体, Y 个关节
```

### 关节警告（正常）
```
关节 xxx 的物体未找到
```

### 退出输出
```
退出物理预览
```

---

## Bug 报告模板

如果发现问题，请记录：

### 问题描述
（简要描述问题）

### 复现步骤
1. 
2. 
3. 

### 预期行为
（应该发生什么）

### 实际行为
（实际发生了什么）

### 环境信息
- 浏览器：
- Box2D 版本：
- 场景复杂度：

### 控制台输出
（粘贴相关错误信息）

---

## 测试完成标准

- ✅ 所有基本功能测试通过
- ✅ 至少完成 3 个测试场景
- ✅ 预览控制全部正常
- ✅ 物理效果符合预期
- ✅ 无控制台错误
- ✅ 性能流畅（60 FPS）

---

**测试愉快！** 🎉

# 版本更新日志

## v2.0.0 - 2025-10-14

### 🎉 重大更新：形状编辑功能

新增强大的形状编辑能力，支持在创建后直接修改形状的尺寸和顶点位置！

### ✨ 新功能

#### 位置和角度编辑
- ✅ **位置坐标编辑**: 在属性面板输入框修改 X/Y 坐标
- ✅ **旋转角度编辑**: 在属性面板输入框修改旋转角度（度）
- ✅ **实时更新**: 修改后物体立即移动/旋转到新位置
- ✅ **撤销支持**: 位置和角度修改完全支持撤销/重做

#### 属性面板编辑
- ✅ **矩形编辑**: 在属性面板输入框修改宽度和高度
- ✅ **圆形编辑**: 在属性面板输入框修改半径
- ✅ **多边形编辑**: 在属性面板输入框修改每个顶点的 X/Y 坐标

#### 可视化顶点编辑（多边形）
- ✅ **双击进入**: 双击多边形进入顶点编辑模式
- ✅ **拖动顶点**: 直接在画布上拖动顶点修改位置
- ✅ **可视化反馈**: 顶点显示为蓝色圆点，拖动时变为红色
- ✅ **顶点索引**: 每个顶点显示编号，方便识别
- ✅ **退出编辑**: 双击空白处或再次双击多边形退出编辑模式
- ✅ **撤销支持**: 所有编辑操作完全支持撤销/重做

### 🎯 使用方法

#### 修改物体位置和角度
1. 使用**选择工具**点击选中任意形状
2. 在右侧**属性面板**找到"位置坐标"部分
3. 修改 **X 坐标**或 **Y 坐标**（单位：米）
4. 修改**旋转角度**（单位：度，0-360）
5. 物体立即移动/旋转到新位置，支持撤销

#### 修改矩形和圆形
1. 使用**选择工具**点击选中形状
2. 在右侧**属性面板**找到"形状尺寸"部分
3. 在输入框中输入新的宽度/高度/半径值
4. 值会实时更新，并可撤销

#### 修改多边形顶点（属性面板）
1. 使用**选择工具**点击选中多边形
2. 在属性面板滚动到"多边形顶点"部分
3. 修改任意顶点的 X 或 Y 坐标值
4. 形状实时更新，支持撤销

#### 修改多边形顶点（画布拖动）⭐ 推荐
1. 使用**选择工具**
2. **双击**多边形进入顶点编辑模式
3. 顶点会显示为蓝色圆点（带编号）
4. **拖动**任意顶点到新位置
5. 拖动时顶点变为红色
6. 完成后**双击空白处**或**点击空白处**退出编辑模式
7. 所有修改可撤销（Ctrl+Z）

### 🎨 视觉改进

- ✅ **顶点控制点**: 6px 蓝色圆点，带白色边框
- ✅ **拖动高亮**: 正在拖动的顶点显示为红色
- ✅ **顶点编号**: 白色数字居中显示在控制点上
- ✅ **状态提示**: 状态栏显示"顶点编辑模式"和操作提示
- ✅ **提示信息**: 属性面板显示"提示：顶点坐标相对于物体中心"

### 🔧 技术改进

- ✅ **命令模式集成**: 所有编辑操作使用 `ModifyPropertyCommand`
- ✅ **实时坐标转换**: 正确处理物体旋转和局部坐标
- ✅ **精确碰撞检测**: 0.3m 的顶点点击半径
- ✅ **深拷贝支持**: 顶点数组正确复制以支持撤销
- ✅ **TypeScript 类型安全**: 所有新代码完全类型化

### 📝 代码统计

- **新增代码**: ~250 行
- **修改代码**: ~80 行
- **总行数**: ~2180 行（main.ts）
- **新增 CSS**: ~40 行（顶点编辑样式）

### 🐛 修复

- ✅ 修复 TypeScript lint 警告（未使用参数）
- ✅ 修复坐标转换中的旋转问题
- ✅ 修复顶点拖动后保存失败的问题
- ✅ 修复多边形双击完成时最后一个点重复添加的问题
- ✅ 优化性能（避免不必要的渲染）

### 📚 更新文档

- ⏳ 待更新 `USER_GUIDE.md` - 添加形状编辑说明
- ⏳ 待更新 `QUICK_REFERENCE.md` - 添加双击编辑快捷方式
- ⏳ 待创建 `SHAPE_EDITING_GUIDE.md` - 详细编辑指南

---

## v1.0.0 - 2025-10-14

### 🎉 首次发布

完整的 Box2D 地图设计器，支持创建、编辑和导出 Box2D 物理场景。

### ✨ 核心功能

#### 形状工具
- ✅ **矩形工具**: 拖动创建矩形，支持任意方向绘制
- ✅ **圆形工具**: 拖动创建圆形，默认半径 0.5m
- ✅ **多边形工具**: 点击添加顶点，双击或回车完成
- ✅ **选择工具**: 点击选中物体，拖动移动物体

#### 关节系统
- ✅ **旋转关节**: 连接两个刚体，支持角度限制
- ✅ **局部坐标**: 关节锚点使用局部坐标，随物体移动
- ✅ **锚点拖动**: 可视化拖动调整锚点位置
- ✅ **实时反馈**: 拖动时高亮显示，放大锚点

#### 撤销/重做系统
- ✅ **命令模式**: 完整的命令历史管理
- ✅ **快捷键**: Ctrl+Z 撤销，Ctrl+Y 重做
- ✅ **50步历史**: 支持最多 50 步撤销
- ✅ **所有操作**: 创建、删除、移动、属性修改全部支持

#### Box2D 坐标系统
- ✅ **完整转换**: 内部使用 Box2D 坐标（Y 轴向上，单位：米）
- ✅ **坐标显示**: 状态栏和属性面板显示米单位
- ✅ **网格系统**: 每格 1 米，带坐标标签
- ✅ **原点标记**: 红色十字标记 (0, 0) 点

#### 视图控制
- ✅ **PPM 缩放**: 5-50 可调，实时生效
- ✅ **原点偏移**: X/Y 轴各 ±20m 范围
- ✅ **滚轮缩放**: 以鼠标为中心智能缩放
- ✅ **中键拖动**: 自由平移画布
- ✅ **重置按钮**: 一键恢复默认视图

#### 属性编辑
- ✅ **刚体类型**: Static/Dynamic/Kinematic
- ✅ **物理属性**: 密度、摩擦力、弹性
- ✅ **阻尼控制**: 线性阻尼、角阻尼
- ✅ **重力缩放**: 可调整重力影响
- ✅ **固定旋转**: 锁定物体旋转
- ✅ **关节参数**: 角度限制、锚点位置

#### 文件操作
- ✅ **保存设计**: 保存为 JSON 格式
- ✅ **加载设计**: 加载已保存的设计文件
- ✅ **导出 Box2D**: 导出标准 Box2D JSON 格式
- ✅ **格式验证**: 自动验证文件格式

### 🎨 用户界面

- ✅ **工具栏**: 直观的工具按钮，支持快捷键
- ✅ **属性面板**: 右侧可滚动面板，实时编辑
- ✅ **状态栏**: 显示工具、对象数、鼠标坐标、消息
- ✅ **视图设置**: 独立的视图控制区域
- ✅ **响应式设计**: 适配不同屏幕尺寸

### 🖱️ 交互体验

- ✅ **实时渲染**: 所有操作立即显示
- ✅ **视觉反馈**: 选中高亮、拖动提示
- ✅ **智能捕捉**: 精确的点击检测
- ✅ **流畅动画**: 无卡顿的交互体验
- ✅ **鼠标光标**: 根据操作改变光标样式

### 📊 技术栈

- **前端框架**: Vite 5.0 + TypeScript 5.3
- **渲染**: HTML5 Canvas 2D API
- **构建工具**: Vite (快速 HMR)
- **类型检查**: TypeScript 严格模式
- **代码规范**: ESLint + Prettier

### 📐 坐标系统

- **Box2D 坐标系**: Y 轴向上，单位米，原点可配置
- **Canvas 坐标系**: Y 轴向下，单位像素，仅用于渲染
- **坐标转换**: 自动在两个坐标系间转换
- **PPM 默认值**: 20 (1米 = 20像素)

### 🎯 默认设置

- **画布尺寸**: 1000×700 像素
- **网格大小**: 1 米
- **PPM**: 20
- **原点位置**: Canvas 中心底部 (0, 0)
- **撤销历史**: 50 步

### 📦 项目结构

```
moonbit_stickman_map_designer/
├── src/
│   └── main.ts              # 主应用代码 (1754 行)
├── index.html               # HTML 入口
├── styles.css               # 样式文件 (488 行)
├── package.json             # 项目配置
├── tsconfig.json            # TypeScript 配置
├── vite.config.ts           # Vite 配置
└── *.md                     # 文档 (25+ 个)
```

### 📚 文档

#### 用户文档
- ✅ `Readme.md` - 项目介绍
- ✅ `QUICK_START.md` - 快速入门
- ✅ `USER_GUIDE.md` - 完整用户手册
- ✅ `QUICK_REFERENCE.md` - 快速参考卡片
- ✅ `TESTING_GUIDE.md` - 测试指南

#### 功能说明
- ✅ `UNDO_REDO_GUIDE.md` - 撤销/重做说明
- ✅ `ANCHOR_DRAG_FEATURE.md` - 锚点拖动功能
- ✅ `VIEW_CONTROLS_GUIDE.md` - 视图控制详解
- ✅ `MOUSE_INTERACTION_GUIDE.md` - 鼠标交互指南

#### 技术文档
- ✅ `ARCHITECTURE.md` - 系统架构
- ✅ `API.md` - API 文档
- ✅ `COORDINATE_CONVERSION.md` - 坐标转换说明
- ✅ `FILE_FORMATS.md` - 文件格式规范

#### 开发文档
- ✅ `CONTRIBUTING.md` - 贡献指南
- ✅ `BOX2D_REFACTORING_COMPLETE.md` - 重构报告
- ✅ `VIEW_CONTROLS_IMPLEMENTATION.md` - 实现细节

### 🐛 已知问题

- 无已知重大问题

### 📝 代码统计

- **总行数**: ~3000 行
- **TypeScript**: ~1750 行
- **HTML**: ~150 行
- **CSS**: ~488 行
- **文档**: 25+ 个 Markdown 文件

### 🎓 学习资源

项目包含完整的文档和示例，适合：
- Box2D 物理引擎学习
- Canvas 2D 图形编程
- TypeScript 项目开发
- 命令模式实现
- 坐标系统转换

### 🚀 快速开始

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 预览构建结果
npm run preview
```

访问 http://localhost:3000 开始使用！

### 👥 作者

GitHub Copilot AI Assistant

### 📄 许可证

MIT License

---

**完整功能，生产就绪！** 🎉

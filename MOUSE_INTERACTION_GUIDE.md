# 🖱️ 鼠标交互增强功能

## 新增的鼠标操作

### 1. 🖱️ 中键拖动平移画布

**操作方式**:
- 按住鼠标中键（滚轮按钮）
- 拖动鼠标
- 松开鼠标中键

**效果**:
- 画布随鼠标移动而平移
- 实时更新原点偏移
- 滑块数值同步更新
- 鼠标光标变为"抓取"状态

**使用场景**:
- 快速浏览大型场景的不同区域
- 比使用滑块更直观和快速
- 精确定位到感兴趣的区域

### 2. 🔍 滚轮缩放

**操作方式**:
- 向上滚动滚轮 → 放大（增加 PPM）
- 向下滚动滚轮 → 缩小（减少 PPM）

**智能特性**:
- ✅ 以鼠标位置为中心缩放
- ✅ 鼠标指向的物体位置保持不变
- ✅ 自动调整原点偏移
- ✅ PPM 范围限制在 5-50

**效果**:
- 每次滚动调整 PPM ±1
- 实时更新视图
- 滑块数值同步更新

**使用场景**:
- 快速放大查看细节
- 快速缩小查看全局
- 比使用滑块更精确和自然

## 🎮 完整的交互方式对比

### 视图缩放

| 方式 | 优点 | 使用场景 |
|-----|------|---------|
| 滚轮 | 快速、以鼠标为中心 | 日常使用、精确缩放 ⭐ |
| PPM 滑块 | 精确数值、范围显示 | 需要特定 PPM 值 |

### 视图平移

| 方式 | 优点 | 使用场景 |
|-----|------|---------|
| 中键拖动 | 快速、直观、自由 | 日常使用、快速浏览 ⭐ |
| 原点 X 滑块 | 精确数值、水平移动 | 需要精确对齐 |
| 原点 Y 滑块 | 精确数值、垂直移动 | 需要精确对齐 |

### 推荐工作流

**快速浏览模式**:
1. 滚轮缩小 → 看全局
2. 中键拖动 → 移动到目标区域
3. 滚轮放大 → 查看细节

**精确编辑模式**:
1. 使用滑块设置精确的 PPM 值
2. 使用滑块设置精确的原点位置
3. 微调编辑

## 🔧 技术实现细节

### 中键拖动算法

```typescript
// 记录拖动开始状态
panStartOriginX = ORIGIN_OFFSET_X
panStartOriginY = ORIGIN_OFFSET_Y
panStartMouseX = e.clientX
panStartMouseY = e.clientY

// 拖动过程中计算偏移
deltaX = currentMouseX - panStartMouseX
deltaY = currentMouseY - panStartMouseY

// 更新原点偏移（转换为 Box2D 单位）
ORIGIN_OFFSET_X = panStartOriginX + deltaX / PPM
ORIGIN_OFFSET_Y = panStartOriginY - deltaY / PPM  // Y 轴反向
```

### 滚轮缩放算法（以鼠标为中心）

```typescript
1. 计算鼠标位置的 Box2D 坐标（缩放前）
   worldPosBefore = canvasToBox2D(mouseX, mouseY)

2. 调整 PPM
   PPM = PPM + delta  // ±1

3. 计算鼠标位置的 Box2D 坐标（缩放后）
   worldPosAfter = canvasToBox2D(mouseX, mouseY)

4. 调整原点偏移，保持鼠标位置不变
   ORIGIN_OFFSET_X += (worldPosBefore.x - worldPosAfter.x)
   ORIGIN_OFFSET_Y += (worldPosBefore.y - worldPosAfter.y)
```

这样确保了缩放时鼠标指向的点保持在相同的屏幕位置。

### UI 同步

```typescript
updateViewControlsUI() {
  // 更新 PPM 滑块和数值
  // 更新原点 X 滑块和数值
  // 更新原点 Y 滑块和数值
  // 处理超出滑块范围的情况（-20 ~ +20）
}
```

## 💡 使用技巧

### 1. 快速返回原点
- 方法 1: 点击"重置视图"按钮
- 方法 2: 中键拖动到红色十字标记 (0,0)

### 2. 精确缩放
- 粗调: 使用滚轮快速缩放
- 微调: 使用 PPM 滑块精确调整

### 3. 大范围平移
如果中键拖动到画布边界，可以：
- 继续拖动（原点偏移可以超出滑块范围）
- 松开后再次拖动
- 或使用滑块

### 4. 组合使用
```
场景: 查看左上角的小物体

操作流程:
1. 滚轮放大到 PPM=40
2. 中键拖动到左上角
3. 微调位置
4. 编辑物体
5. 滚轮缩小到 PPM=20 查看全局
```

## ⚠️ 注意事项

### 1. 原点偏移范围
- 滑块范围: -20m ~ +20m
- 实际范围: 无限制
- 如果超出滑块范围，滑块会显示边界值，但数值显示是真实值

### 2. PPM 范围
- 固定范围: 5 ~ 50
- 超出范围时滚轮无效

### 3. 中键冲突
- 某些鼠标没有中键
- 可以使用滑块作为替代方案

### 4. 触控板
- 某些触控板可能不支持中键
- 可以尝试三指拖动（取决于驱动设置）
- 建议使用滑块

## 🎯 快捷键总览

| 操作 | 快捷键/鼠标 | 说明 |
|-----|-----------|------|
| 放大 | 滚轮向上 | PPM +1 |
| 缩小 | 滚轮向下 | PPM -1 |
| 平移 | 中键拖动 | 移动视图 |
| 重置 | 点击按钮 | 恢复默认 |
| 微调缩放 | PPM 滑块 | 精确数值 |
| 微调位置 | 原点滑块 | 精确数值 |

## 🚀 性能优化

- ✅ 中键拖动时实时渲染（流畅）
- ✅ 滚轮缩放时实时渲染（流畅）
- ✅ 只在必要时更新 UI 控件
- ✅ 使用 `preventDefault()` 避免浏览器默认行为

## 📱 兼容性

### 完全支持
- ✅ Chrome / Edge
- ✅ Firefox
- ✅ Safari
- ✅ 任何带三键鼠标的设备

### 部分支持
- ⚠️ 触控板（取决于驱动）
- ⚠️ 二键鼠标（无中键，使用滑块）

## 🎊 总结

现在您有**三种方式**控制视图：

1. **鼠标交互**（推荐日常使用）
   - 滚轮缩放：快速、自然
   - 中键拖动：灵活、直观

2. **滑块控制**（精确调整）
   - PPM 滑块：精确缩放
   - 原点滑块：精确定位

3. **组合使用**（最佳体验）
   - 鼠标快速导航
   - 滑块微调精确值
   - 重置按钮快速复位

享受更流畅的地图设计体验！ 🎉
